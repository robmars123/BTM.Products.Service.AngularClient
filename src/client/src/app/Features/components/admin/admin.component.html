@if (products() && products.length === 0) {
<div class="text-muted">No products found.</div>
}
<!-- Search Section -->
<section class="py-5 text-center container mb-5">
  <div class="col-lg-8 mx-auto">
    <form
      [formGroup]="searchForm"
      (ngSubmit)="onSearch()"
      class="searchProduct d-flex"
      style="margin: auto; max-width: 300px"
    >
      <input
        id="keyword"
        type="text"
        class="form-control rounded-end-0"
        placeholder="Search..."
        formControlName="keyword"
      />
      <button type="submit" class="btn btn-outline-primary rounded-start-0">
        <i class="fa fa-search" aria-hidden="true"></i>
      </button>
    </form>
  </div>
</section>
<!-- Add Product Section -->
<div class="border p-3 mb-3 shadow-sm">
  <form [formGroup]="addProductForm" (ngSubmit)="addProduct()">
    <h6>Add Product</h6>
    <hr />

    <!-- Product Name -->
    <div class="form-group row mb-3">
      <label for="ProductName" class="col-sm-3 col-form-label"> Product Name </label>
      <div class="col-4">
        <input
          id="ProductName"
          type="text"
          class="form-control"
          placeholder="Product Name"
          formControlName="name"
        />
        @if (addProductForm.get('name')?.invalid && addProductForm.get('name')?.touched) {
        <small class="text-danger">Product name is required.</small>
        }
      </div>
    </div>

    <!-- Price -->
    <div class="form-group row mb-3">
      <label for="Price" class="col-sm-3 col-form-label">Price</label>
      <div class="col-3">
        <input
          id="Price"
          type="number"
          class="form-control"
          placeholder="0.00"
          formControlName="unitPrice"
        />
        @if (addProductForm && addProductForm.get('unitPrice')?.invalid &&
        addProductForm.get('unitPrice')?.touched) {
        <small class="text-danger">Price must be greater than 0.</small>
        }
      </div>
    </div>

    <!-- Upload Image -->
    <div class="form-group row mb-3">
      <label class="col-sm-3 col-form-label">Upload Image</label>
      <div class="col-sm-5">
        <input type="file" class="form-control" (change)="onFileChange($event)" />
        @if (returnMessage) {
        <span class="text-success">{{ returnMessage }}</span>
        }
      </div>
    </div>

    <!-- Submit Button -->
    <div class="form-group row">
      <div class="col-sm-3 col-form-label">
        <button class="btn btn-danger" type="submit" [disabled]="addProductForm.invalid">
          Add
        </button>
      </div>
      <div class="col-sm-6 mt-3">
        <span class="text-success"
          ><em>{{ addSuccessMessage }}</em></span
        >
      </div>
    </div>
  </form>
</div>

<!-- Display products -->
<div class="row align-items-start">
  <div class="col">
    <div class="row">
      <!-- First column -->
      <div class="column">
        <div class="table-container border ps-2 pb-2 shadow-sm">
          <table class="table col-12 table-striped">
            <thead>
              <tr>
                <th class="col">Product Name</th>
                <th class="col">Product Price</th>
                <th></th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              @for(product of products(); track product.id) {
              <tr>
                <td>{{ product.name }}</td>
                <td>{{ product.unitPrice | currency : 'USD' : 'symbol' : '1.2-2' }}</td>
                <td>
                  <button
                    class="btn btn-secondary"
                    type="button"
                    (click)="selectProduct(product.id)"
                  >
                    Modify
                  </button>
                </td>
                <td>
                  <button class="btn btn-danger" type="button" (click)="delete_Click(product.id)">
                    Delete
                  </button>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>

        <!-- pagination -->
        @if (totalPages > 1) {
        <nav class="mt-4">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="page === 1">
              <a class="page-link" (click)="changePage(page - 1)">Prev</a>
            </li>

            @for (num of visiblePages(); track num) {
            <li class="page-item" [class.active]="page === num">
              <a class="page-link" (click)="changePage(num)">{{ num }}</a>
            </li>
            }

            <li class="page-item" [class.disabled]="page === totalPages">
              <a class="page-link" (click)="changePage(page + 1)">Next</a>
            </li>
          </ul>
        </nav>
        }
      </div>
      <span>{{ SearchReturnMessage }}</span>
    </div>
  </div>
  <!-- Second Column -->
  <div class="col col-5 border h-100 overflow-hidden p-4 content m-auto shadow-sm me-2">
    @if (!updateProductModel) {
    <p><em>Select to view product...</em></p>
    } @else {
    <form [formGroup]="updateProductForm" (ngSubmit)="updateProduct()">
      <h6>Update Product</h6>
      <hr />

      <!-- Product Name -->
      <div class="form-group row mb-3">
        <label for="ProductName" class="col-sm-3 col-form-label"> Product Name </label>
        <div class="col-4">
          <input
            id="ProductName"
            type="text"
            class="form-control"
            placeholder="Product Name"
            formControlName="name"
          />
          @if (updateProductForm.get('name')?.invalid && updateProductForm.get('name')?.touched) {
          <small class="text-danger">Product name is required.</small>
          }
        </div>
      </div>

      <!-- Price -->
      <div class="form-group row mb-3">
        <label for="Price" class="col-sm-3 col-form-label">Price</label>
        <div class="col-3">
          <input
            id="Price"
            type="number"
            class="form-control"
            placeholder="0.00"
            formControlName="unitPrice"
          />
          @if (updateProductForm && updateProductForm.get('unitPrice')?.invalid &&
          updateProductForm.get('unitPrice')?.touched) {
          <small class="text-danger">Price must be greater than 0.</small>
          }
        </div>
      </div>

      <!-- Delete -->
      <div class="form-group row mb-3 align-items-center">
        <label for="isDeleted" class="col-sm-3 col-form-label">Deleted</label>
        <div class="col-3">
          <input
            id="isDeleted"
            type="checkbox"
            class="form-check-input"
            formControlName="isDeleted"
          />
        </div>
      </div>

      <!-- Upload Image -->
      <div class="form-group row mb-3">
        <label class="col-sm-3 col-form-label">Upload Image</label>
        <div class="col-sm-5">
          <input type="file" class="form-control" (change)="onFileChange($event)" />
          @if (returnMessage) {
          <span class="text-success">{{ returnMessage }}</span>
          }
        </div>
      </div>

      <!-- Submit Button -->
      <div class="form-group row">
        <div class="col-sm-3 col-form-label">
          <button class="btn btn-danger" type="submit" [disabled]="updateProductForm.invalid">
            Update
          </button>
        </div>
        <div class="col-sm-6 mt-3">
          <span class="text-success"
            ><em>{{ updateSuccessMessage }}</em></span
          >
        </div>
      </div>
    </form>
    }
  </div>
</div>
